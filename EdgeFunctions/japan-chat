// import { serve } from "https://deno.land/std@0.168.0/http/server.ts";

// const GROQ_API_KEY = Deno.env.get("GROQ_API_KEY");

// const corsHeaders = {
//   "Access-Control-Allow-Origin": "*",
//   "Access-Control-Allow-Headers":
//     "authorization, x-client-info, apikey, content-type",
// };

// const SYSTEM_PROMPT = `You are a Japan Travel Assistant. Help users with itineraries, transportation, food, halal options, sightseeing, and tips. Respond in friendly, clear English with emojis.`;

// serve(async (req) => {
//   if (req.method === "OPTIONS") {
//     return new Response(null, { headers: corsHeaders });
//   }

//   try {
//     const { messages } = await req.json();

//     if (!messages || messages.length === 0) {
//       return new Response(JSON.stringify({ error: "No messages provided" }), {
//         status: 400,
//         headers: { ...corsHeaders, "Content-Type": "application/json" },
//       });
//     }

//     if (!GROQ_API_KEY) {
//       throw new Error("GROQ_API_KEY is missing");
//     }

//     // Format messages for Groq (OpenAI-compatible)
//     const formattedMessages = [
//       { role: "system", content: SYSTEM_PROMPT },
//       ...messages.map((m: { role: string; content: string }) => ({
//         role: m.role,
//         content: m.content,
//       })),
//     ];

//     // Use Groq API - super fast and free!
//     const response = await fetch(
//       "https://api.groq.com/openai/v1/chat/completions",
//       {
//         method: "POST",
//         headers: {
//           Authorization: `Bearer ${GROQ_API_KEY}`,
//           "Content-Type": "application/json",
//         },
//         body: JSON.stringify({
//           model: "llama-3.1-8b-instant",
//           messages: formattedMessages,
//           max_tokens: 300,
//           temperature: 0.7,
//         }),
//       }
//     );

//     if (!response.ok) {
//       const errText = await response.text();
//       console.error("Groq API Error:", errText);
//       console.error("Status:", response.status);
//       throw new Error(`API returned status ${response.status}: ${errText}`);
//     }

//     const data = await response.json();
//     console.log("API Response:", JSON.stringify(data));

//     // Extract message from OpenAI-compatible response
//     const text =
//       data?.choices?.[0]?.message?.content ||
//       "Sorry, I couldn't generate a response. Please try again.";

//     return new Response(JSON.stringify({ message: text.trim() }), {
//       headers: {
//         ...corsHeaders,
//         "Content-Type": "application/json",
//       },
//     });
//   } catch (error: unknown) {
//     console.error("Chat Function Error:", error);
//     const errorMessage =
//       error instanceof Error ? error.message : "An unexpected error occurred";
//     return new Response(
//       JSON.stringify({
//         error: errorMessage,
//       }),
//       {
//         status: 500,
//         headers: {
//           ...corsHeaders,
//           "Content-Type": "application/json",
//         },
//       }
//     );
//   }
// });

// THESE ALL IN THE DATABASE  EDGE FUNCTION
